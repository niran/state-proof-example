pragma solidity ^0.8.19;

import "forge-std/Test.sol";

import {PulledSlot, IL1Block} from "../src/PulledSlot.sol";

contract L1Block is IL1Block {
    function hash() external returns (bytes32) {
        return 0x2fa08dbb467eadcbdcd96c3d12f7f456c477c607e638f025e5df7761aa719a08;
    }
}

contract PulledSlotTest is Test {
    PulledSlot pulledSlot;

    function setUp() public {
        IL1Block l1Block = new L1Block();
        pulledSlot = new PulledSlot(
            // Pull the value of slot 0 of the L1 contract at
            // https://sepolia.etherscan.io/address/0x45b924Ee3EE404E4a9E2a3AFD0AD357eFf79fC49
            0x45b924Ee3EE404E4a9E2a3AFD0AD357eFf79fC49,
            keccak256(abi.encode(0)),
            address(l1Block)
        );
    }

    function test_setSlotValue() public {
        // Block https://sepolia.etherscan.io/block/5539783
        bytes memory blockHeaderRlp = hex"f9024ba030e5748d275d58d95569d6037932b0a7d7166658e61c4dc43a01160b2a6921a9a01dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347943826539cbd8d68dcf119e80b994557b4278cec9fa09389d1be2f04b6babd053ee6d134f0b3fb316fccb28cbc00e53d992468702a49a0ed06ff80521622bdfa65e5c0894c3ae98755cad2a50fc4d6661e4087c5ee8343a0e16f616ebbcc8ca067fb80517ce6ee2184e04abf1e797c7705afa4a628af9357b90100840e484b83014248119104a23912162080f0500004008002018048120100a910170c0440e0021004e122044e201504923900108630b010200993da11242428414054602a0c258340c815004a00a040479701002401964648d808000baa004293a0040004aed102036043045490081b0f041840c005ca94040248f21b007026004662010c9a011404a003180162006680b0504067680844282311b08404702850420a4c8540800b664c010914211020080a122225a528221e0cb1042214014182818f596205809881813400c1b813380482040112056c60029a258b04806562015c5c80104820820020d60022b08c0042944000724db80252002a1ac08b08040080835487c78401c9c38083a3fb148465fddae880a023def93297c72eae47298c6fe34662710d5fe84643bb6938203ac1c89a8786c38800000000000000008409eb1beca0ff7f9713ea8bc4f90fa5ecdf9a25711146df8643ea71b8ed4c696edc0da4d8e48306000084051c0000a0be0d31c6dee39220a76d7a04de091a50301730c0486a6bdcc1f3e24396e0d302";
        
        bytes[] memory accountProof = new bytes[](8);
        accountProof[0] = bytes(hex"f90211a088e3a40afe0ef8c8a317ba4429d373d21651d8b25033fb0701ea5fe055eff8aba06f7d6bcebd05490573976ac77b1a494e6b0f90bf31fbd84548f766903ae8f74aa013dba63bc90236b2c622e76e104fdd009e3b4ca8fedadee9e41177cc5d8192baa09402634944059d8305056db62c7a8be9283b44bbfa368a324447389bc156975ca0b4c6b31f3f5aea1028867adfa5e54d3636b7826f88bb29ab36f05a7a22ecb0f7a013528966fe9021878d1711a19c303f9223920a283f97595606b63c093b4174baa0056316368d86c6b7e5191aa9566d4433903d3350135ab6ff45ae5ff4b5973282a0feaa38e22dde79b79c95fb7a3fba3f76b26a59e5c9f40e9c2401341500c85100a08d05aa387688618839bf59bb39ac61ecdc270c951d661991b14694113a9e436ca064f308f32f21df46254bbcf32021d92a9489fb6e5063213fe3f22429c99addeda0f5442023a9e1a685f8e89739e321e6a95b89b2906ad8eb76e16a954daa7aa912a0daa5630eb02b0c7abcf332cd5c2749ef5c0643be8744496a4b0770ce9658f22da07e6d218e38793750a6c9f5a587d67ae7bcdca23b3699599737756e1ab112b95aa00d7457d80ccd90401f81b1bc6d877029ea4f9d9384c55cb3326da1ec7b656fa3a0044927d4a44acc3a6e9b0bc4330df1efc19b340a0d9a41f56aba8baf9e9e21aaa062d027bc526f3de6a390324a4aca14c716e8de29995267c51e56c78145fd651980");
        accountProof[1] = bytes(hex"f90211a0b511acf655de1a40eeb717e6cbc34c5c83d8c358595051dd79b68d865cb723b6a0aea7cae1f6dea0270b122a71c47c6889c938287bb7e9cbdbda8b267005562d21a06c9cc18fd34efc815447b3b6d3f48267e8511ea7dfdfd13f1b33bfdfed234b1fa089857a3757f05086a08846df3fd5c6eb4f9096356b795c8552354725e9ce53cca0b4db8e29eacb0f499c6c7f25d4e53ec628677d1b43a71ae5d4f2a7bfda9eaf8ca06b0ba1d61c83bd330a58575b8083712d7c79d665832133f4fcecc087a955b45ba02a51a7249839f0d19659907efe243d195adffdccab663643fbf732d9eacefdfca0654b957ab328e135d185b05e2e31f514506762dbe3909bf312bca5bdf3e49dcea07cb47e2b441aea005c916e930e76835f7c98ee5735b5d765630b2562dfb7d0dea0abc6c61bd979138d1e7137b475df5fbc83507738fccdcc61b35264dbb1967ae6a05a586652b93760005e10b8caf1f0be5f1ba59628660c5945ebc5cb9f6786cb8da02c08e4bdea0430995a6b9a6306c32d56b7a5b802c924763518c11374c1424beca06abc4902377d644dce8b8f340435f9b3c3697a5ce9cdd1bce34e23f47e56a374a06352b5508c248dbca1959d7785a044751e150276ba0be47bf387c3d8de52ea59a0c321f9b10471fe98e90d560321ae9ac010e6b440f435a10ac976b849268c8c56a06e9dc15de3b5b9a80ff81af2aed224ad412e924000694292fb536b71d968469d80");
        accountProof[2] = bytes(hex"f90211a0b7eee3ae08813100e67967ad8823d0d40134def302b39ebb85a5d4d3348a6779a050d54f51278b705570f0921d24639d06ea5e0937de19ab287c718cf2ddc1c368a0de6454619554f0a563ba03238382b8f8430dfea7ac39c8150632bfafc908c947a09256dd456488221252df68b7181dc3beef235282c6737c6a898c0afb80ed8d55a0d5b7334a156ef334572c86056a57dda51d8d763d1c07452edb31d6ccc1153a07a083c3cb951166648478a0f70c8f677075ca182189734b3fd6677514b511ab9caba0c60fb5aa8dc84c928f5a9e94797bd4728c7ee71009d9a867841966c3a61c936aa0ab3b3ab63931fae7ec07b4f668fcdcd7e90de167ec71f732b961a780cfb0218da0e676d59b5bea117d1d0d12a99067c815f95fd1a3a5f5586c70b26334d560f81da0e5d3165dcce68e35d7c285f366a7844106ca427502c452f1356a5f9e22555a47a033b9a32356a0fb39cfa308f49cb2e8f217ac7795ede8c6f6cb5e576152b36e6ea0de35ee726a1873ee27a6b50984b6ec53f8c2f660c31fc1a68f68b55c96e51625a04c8bac8f885c654c94aa9fbfb92ed104fc115714fce541cba4cfb16be218688ba002903ff14e6846e4466d7578e885b494f0720c2bf250ca7242ae135234edf7a1a010b9676ec55c89de4d7be59d47657cda7232fb57dbac68e0d47efb070ef4e0e2a0f95f960255fbfd0d0a1659a32f920ed3173e904f585b93b379f891e85017dd5280");
        accountProof[3] = bytes(hex"f90211a057cd5c108fd0b83f7524be26e37b1054fca4bf0c9fa972daa5a2bbe7c3de3125a03fa786796ec1ed5d960b0a91b9536f1ff6294d456df2195f290c26f4fd8dc209a013e4f186d161e7bf7f25a2de9415f337251bd105c3774800d7fed02aac0d671fa00b2b1fef12eeeedd0a148a4fd5e1f5f60e08bff955e4ccfbb21f67ee853cb8b9a00d9fa5c95f857363b4ff5546509c7d723e04fe78232fd65038411ab519f73df8a0960dfcc9e766e432630d044e73ddfca80dd6290a42fea28351ee08f4f95fe877a00c78e26309c4ca568fd17ea7521413cca34995fc12ce7cfa124de04c29870dd4a044325d2c942c8265527a74d78e1f124667992a087f947a5f03b24b0650c9fff2a0b3a8218b5fe4905599fe0c8ab79b92834bdc07bf3eb0f40232e4532883991438a09ba17a3fe114c86e9c4e826abe45a449bc1a0ddecdfe1108afaaef47c7b17f1da0854761f87ffef2351674530dcabfa71acab36f6427bb71cf7038d17b0c3f3f45a088e1338f0f6951473a759202af3c076edd454a1cf2fe9100a812fbe2a4c9e50aa0d8d6e1666eb187a1b744fe9bbb22e75759190f3e1a2e211d00b84972d8576feaa01befeb6217ea77051fb145544d84e0b190ce7abac9f1c7d34a9695bd4236889ba05c2922e55e3747d34e064f95afe44ab6c53cdf794e40ad9e231e349dbc0194a9a03e3698883fb58e16d9d96bd8371e15d4ccd58f41e3d9dc7c1d47dc21b87a1d8c80");
        accountProof[4] = bytes(hex"f90211a0d810e5755e06bcd3b28d6989d29320dadb297b3197fe9a0f63008a08967fa4eea097105388f0af6eb1cbb1df53f51fc77789fdaeae0a22cd854d5e3e51dbab56cea0b41c13c5eb9fd2a3c32b2878cc615b6de2a18976a0191ad8da68f87ea163f8b3a014c3f7ff9a2b130c6a3cdd9e27b1010eccf52ec74b56f0405c1250135b88ded1a04adf238db0e7f901154716e0b38816fa471e6b6377b105276125f5f18f544d4fa0b1e0f7289de8ba3915df17e3a404135a7d5f80103d28895cafe870ca46881487a0fccaf129f1f3f1bbed306298446fb8b3dc1363bf397a8e7688b24883840134f8a0477a3b087e3a25a9237000a52457918ade1100b663b4555a19de30e0a06c2472a0b585ae9d2e23185162fe71b0e2fdeb22dfef283f516602af668bc11fdfb045c9a0f5704c54f9dcdcf498022b96d777f71b88422c71c106decbdf39598abd1b3400a0c9f19eafbbd7b8715f79d6327d97738ca0b97d072524e81d2897afee4e32098da05410046e143e8c7b76e6bac2e969503dccb2499f89a0195a473f0ca4651ff637a09251a3e41be2f31e5f28d4dfb29ee7f9e4843a3361c825789ea3546661df0261a09ebb1eaea278509b99c5dea3d6cd5d2c8859769bae518a4537584725ed8365dea02b04b801c6713a1f3fe39068930de7504122438aeab31144224b05bd3416bffca0235283fd9893ac3e6fa331c435b9beb8bf8833b6fe17170a15522f5b68057cfa80");
        accountProof[5] = bytes(hex"f901d1a0d781ec6b186242e279914d6da4f615443778d0e11d6d625bf01132924774edbfa0bea9d3ad4a89e25386990bd310f425a3aa58a10716cf46ef026c9c08c08f9502a016b509690c804c078b4d70646c02f9a288e9520f439ac300a8322a50216848eea049128407835fe8c5d122dad00cbc6391024f66d0b2e2cbf5cd7f1205fbe2b2f7a0887f4dec52cdbbc65ae5e310418e7f6c904359896afa9d4c2e41cd668dd4ff55a02b09047dc9db11a443549054cfc94c9a559ac2638b4541d030ee7a6b3d78ada7a0cb0e061333762bcaba537a876a84a9c7310b8b77fa7494edaf0d67824729a9bba0d3657376d8def88f64210ef977b8d66e85d9ce6d518ae9268b51e305386ed29ca065f357a275b448230b07c8d0a0a0d21bb3a9a95d1498ae7a7030acf68f9588d8a057f7a83ba044111100d30462d391201f2a181100899c96c16e958bec33143b7480a007fc5cdd7da302f4386301aa65ffdaa26c43dd57989666ca523df0f981db9d1ba059a6d40faa1b527b8230ece6674549fe5ca4a713726ff687dc6de11459eff2b780a0aab58fd3d94cf5aa7c8e003ea7b7f72d9a9556b51a7aee160d4d70c776c2731ea0ebca5986ee0f90f572f5779ea5d2162d79ccaaebdeee2645cbfa499d3d32af5680");
        accountProof[6] = bytes(hex"f87180a0708c7f62413dcfe9f17b7878d9087833c89f8a75e3d1585dcb9a2f421559cf2b808080808080808080a0e6becb031f620e986f0d2990653d8e800cc539233dbd6e617916f5aae4c7b5d6a08614be3110e9da292f6cadf1e6c48c533cad91c07b9b6daa70cfc0ee4714219d80808080");
        accountProof[7] = bytes(hex"f8669d3f5dbf40c0f1562fe39f2b9e02d9a83f3ffd128399fcc792d09218273cb846f8440180a0cc13c3b773f916cce3bbbe8104433c9c915c9081132cf60da09425ee9bbcf346a0765bb438c87fec6db0c6028b5cd9bfc0fa8d8332299e8f571768f3f32a5ae40c");

        bytes[] memory slotProof = new bytes[](2);
        slotProof[0] = bytes(hex"f8d18080a0909cc4a318160f8fb69baaada5962136a180c97e5f2b08718937d6f95f5a819aa0f6555720d931acc177d2164a8dc1465cbf7c7146944f6d2bf86c70b3aeb499e5808080a0211d6783eb2d7ddd6713a21a3ad9c8672dcc6fbee2694425487349855c0a4c3b8080a05105c5a2a4658149fe0271f2e3b2985fe2dc718cad6db871bbf23d78af85ff58a0a094ac537e31b5ed13ab17c40edb286e362ecc763e44ca0bc59630e33d6cec09808080a048ca42babda7e898e61974776cd4b1057e8887833dc286a04cebe51d8710c87780");
        slotProof[1] = bytes(hex"f843a0390decd9548b62a8d60345a988386fc84ba6bc95484008f6362f93160ef3e563a1a02f45065dfd3be989d8fd41ab263bebe401d81a8e10d0adfaf361907b1a5857f4");
        
        pulledSlot.setSlotValue(blockHeaderRlp, accountProof, slotProof);
        assertEq(bytes32(pulledSlot.slotValue()), 0x2f45065dfd3be989d8fd41ab263bebe401d81a8e10d0adfaf361907b1a5857f4);
    }
}
